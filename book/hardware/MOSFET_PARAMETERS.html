<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>An introduction to MOSFET parameters - Molonoy Electronic Speed Control (MESC) Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction/INTRODUCTION.html"><strong aria-hidden="true">1.</strong> Introduction to the MESC</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../introduction/FORWARD.html"><strong aria-hidden="true">1.1.</strong> Forward</a></li><li class="chapter-item expanded "><a href="../introduction/LICENSE.html"><strong aria-hidden="true">1.2.</strong> License</a></li><li class="chapter-item expanded "><a href="../introduction/FEATURES.html"><strong aria-hidden="true">1.3.</strong> Features</a></li></ol></li><li class="chapter-item expanded "><a href="../operation/INTRODUCTION.html"><strong aria-hidden="true">2.</strong> Theory and Operation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../operation/THEORY.html"><strong aria-hidden="true">2.1.</strong> Theory of operation</a></li><li class="chapter-item expanded "><a href="../operation/CONTROL.html"><strong aria-hidden="true">2.2.</strong> Control loops</a></li><li class="chapter-item expanded "><a href="../operation/PORTING.html"><strong aria-hidden="true">2.3.</strong> Porting to other microprocessors</a></li></ol></li><li class="chapter-item expanded "><a href="../debugging/DEBUGGING.html"><strong aria-hidden="true">3.</strong> Debugging STM32CubeIDE</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../debugging/FIRMWARE_INTRO.html"><strong aria-hidden="true">3.1.</strong> Getting started</a></li></ol></li><li class="chapter-item expanded "><a href="../MP2/INTRO.html"><strong aria-hidden="true">4.</strong> Reference ESC: the MP2</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../MP2/PCB_ASSEMBLY_TESTING.html"><strong aria-hidden="true">4.1.</strong> Assembly</a></li><li class="chapter-item expanded "><a href="../MP2/HIGHER_AMP_ASSEMBLY.html"><strong aria-hidden="true">4.2.</strong> Increasing amperage</a></li></ol></li><li class="chapter-item expanded "><a href="../hardware.html"><strong aria-hidden="true">5.</strong> Hardware</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../hardware/QS165_MP2_WIRING.html"><strong aria-hidden="true">5.1.</strong> Additional wiring for an QS165 motor</a></li><li class="chapter-item expanded "><a href="../hardware/ENCLOSURE_GALLERY.html"><strong aria-hidden="true">5.2.</strong> A gallery of enclosures</a></li><li class="chapter-item expanded "><a href="../hardware/MOSFET_PARAMETERS.html" class="active"><strong aria-hidden="true">5.3.</strong> An introduction to MOSFET parameters</a></li><li class="chapter-item expanded "><a href="../hardware/MOTOR_PARAM.html"><strong aria-hidden="true">5.4.</strong> Measure motor resistance and inductance</a></li><li class="chapter-item expanded "><a href="../hardware/MP2_F405PILL_PINOUTS.html"><strong aria-hidden="true">5.5.</strong> Information about the F405 pill</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Molonoy Electronic Speed Control (MESC) Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="choosing-mosfets-for-the-mp2-controller"><a class="header" href="#choosing-mosfets-for-the-mp2-controller">Choosing MOSFETs for the MP2 Controller</a></h1>
<h2 id="relevant-mosfet-specifications"><a class="header" href="#relevant-mosfet-specifications">Relevant MOSFET Specifications</a></h2>
<p>Drain-source Breakdown Voltage (BVdss) refers to the voltage across the drain-source terminal that causes the drain current (ID) to suddenly rise. Drain-source on-resistance (RDS(on)) refers to the effective resistance between the drain and the source when the MOSFET is in the on state. RDS(on) impacts the max current rating of the MOSFET and the heat generated by the MOSFET is directly proportional to this value. RDS(on) is also associated with current loss. So when choosing a TO220 MOSFET package for the MP2, follow these values closely. </p>
<p>For MOSFETs on the MP2, you want:</p>
<p>BVdss = 20% margin over your battery’s max voltage 
RDS(on) &lt;= 4mOhm </p>
<img src="pics/MOSFET_PARAM01.png" title="Table 1">
<h2 id="avoiding-parasitic-activation"><a class="header" href="#avoiding-parasitic-activation">Avoiding Parasitic Activation</a></h2>
<p>The gate of a MOSFET is insulated by a thin silicon oxide which results in a capacitance between the gate-drain, gate-source and drain-source terminals. The capacitance values are described by the Input Capacitance (Ciss) and  Reverse transfer capacitance (Crss) directly reflect the switching performance of a MOSFET. (Other factors like reverse recovery charge can also be considered). These Ciss/Crss capacitances form a potential divider between the battery and the MOSFET source. Much like resistors, they have the effect of pulling the gate up or down when the MOSFET switches. Figure 1 shows that when the gate voltage bumps above the threshold, current starts to flow and it short circuits the battery. This is a problem. Quoting <a href="https://drive.google.com/file/d/1NGAKFHYZfCwJLpQ9wMGC9iVUuzCymuSV/view">this document</a>, “parasitic, or unwanted, turn-on of the power MOSFET is a phenomenon which happens in the reality more often and can cause more damage then usually known. Its appearance often leads to the destruction of the MOSFET…”. To avoid unusual destruction from parasitic turn on, select a MOSFET with a high Ciss/Crss ratio. You are looking for something like what is shown in Table 1 -- as long as that data is true -- we have a ratio of ~200, and the MOSFET should be immune to parasitic turn-on. </p>
<p>Another consideration is the Gate Threshold Voltage (Vgs) which characterizes the voltage between the gate and source that will switch on the MOSFET. When Vgs is exceeded, the MOSFET turns on and Drain Current (e.g., &quot;ID&quot;) begins to flow. The Transfer Characteristics of a MOSFET shown in Figure 1, displays a knee in the curve around 4V which is good because at this level the MOSFET is more resistant to parasitic turn on.  But be careful -- a higher Vgs is usually at the expense of some RDS(on) -- which we want to minimize. </p>
<img src="pics/MOSFET_PARAM02.png" title="Figure 1">
<h2 id="optimum-dead-time-values"><a class="header" href="#optimum-dead-time-values">Optimum Dead Time Values</a></h2>
<p>The MP2 uses a half bridge configuration shown in Figure 2 with two N-channel MOSFETs between Vbat and ground to drive each motor phase. The two half bridge MOSFETs are referred to as “high-side” and “low-side”. During its operation the high-side and low-side MOSFETs trade switching between each other in order to drive current to each motor phase. Shoot through refers to a situation where both high-side and low-side MOSFETs are simultaneously fully or partially turned on, allowing current to flow between Vbat to ground. Dead time, refers to the period of time between switching the MOSFETs to protect against shoot through. </p>
<img src="pics/MOSFET_PARAM03.png" title="Figure 2">
<p>Factors that control how quickly MOSFET switching also important to setting the correct dead-time. For example, depending on the selection of the parts you’re using, the MP2 may have 4.7 ohm gate resistor with 3 x 7.4nF capacitance. This combination of factors gives a time constant of 104ns. Turn on threshold is usually reached within 1 time constant and turn off in 1.5 to 2.5 time constant. MP2 users will therefore need at minimum 1 time constant dead time to avoid the high and low side MOSFETs coming on at the same time. There is additional resistance coming from the MOSFET driver which impacts switching, and the capacitance between the drain and gate (i.e., &quot;Miller capacitance&quot;) also reduces the switching speed.  Rise time for the MOSFET is also associated with Ciss as well as the package temperature. Taken all together, in practice, 3 time constants dead time is minimum, 4 usually optimal, and 5 is safe.</p>
<h2 id="snubber-resistors"><a class="header" href="#snubber-resistors">Snubber Resistors</a></h2>
<p>Surges of voltage between the MOSFET drain and source are able to feed back through the gate because of electromagnetic induction and parasitic capacitance resulting in unwanted oscillation, which is often referred to as &quot;ringing&quot;.  These transient voltages are shown in Figure 3. Ringing is inevitable with fast switching, but snubbers in the circuit reduce the overall gain of oscillation and will decay the oscillation more rapidly. Depending on the choice of MOSFET you select, the MP2 may not need snubbers, but as you can see in the <a href="https://drive.google.com/file/d/1S_ANmKU4OLiC335F1DV1td9k-rrzCTln/view">MP2 schematic</a> it is equipped with snubber resistors (RS1, RS2, RS3) and capacitors (CS1, CS2, CS3). </p>
<p>In situations where you get ringing on the MP2, you will need to dampen the oscillation by choosing the R and C snubber values, and soldering in these components. (Dont panic, the footprints for these components are 2.0 x 1.2 mm.) Look at the behavior of the MOSFETs on the MP2 by running it at moderately high current, and putting an oscilloscope probe on the test points connected to the MOSFET gates. (The test points are labeled with “TpGS” on the schematic.) The ringing frequency will be in the 20 to 150MHz region. You then tune the snubber so that it dampens the targeted ringing frequency. To achieve this, set C to roughly half the MOSFET total Coss (output capacitance) and the R such that the RC frequency is equal to the ringing frequency. If that doesn't solve ringing problems, you may have to increase the gate resistors (labeled RG1-6 on the schematic) which currently are 4.7 ohm. Changing these resistors may also require modifying the dead time. </p>
<img src="pics/MOSFET_PARAM04.png" title="Figure 3">
<p>A practical example (text taken from the <a href="https://drive.google.com/file/d/1S_ANmKU4OLiC335F1DV1td9k-rrzCTln/view">MP2 schematic</a>)
Rough approximation: RC = 1/2 ringing period, e.g. 30MHz ringing -&gt; 3ns period -&gt;1.5ns RC, 2nF 1ohm is a good starting point. Typically, C = 1-5nF, R = 0.5-5 ohms. The capacitor determines the power dissipated, the resistor dissipates the power. The highest damping factor usually where Csnub ~=Coss MOS.</p>
<p>Other MOSFET Properties: Switching Losses
Earlier we said RDS(on) is associated with the MOSFET’s current loss, which translates to a power loss in heat which can be described by this equation:</p>
<p>P=(√2xI)² x RDS(on)</p>
<p>Where I represents currents and the units for P is in watts. This is time shared between high and low side so a further division by 2 is required.</p>
<p>Switching losses are described by:</p>
<p>Vbus x Iphase x switching time.</p>
<p>Where Iphase is average (not RMS) and switching time will be measured using a scope. Body diode conduction losses are given by:</p>
<p>Dead time x Iphase(avg) x Vdiode x Fpwm x 2 </p>
<p>Where dead time is the effective dead time where both MOSFETs are actually off, ~200ns if set up well, Vdiode is usually 1volt, Fpwm x 2 is per phase. </p>
<p>Note, loss to the gate resistors is negligible and overall, RDS(on) usually dominates switching losses. </p>
<h2 id="suggested-mosfet-part-numbers-from-endless-sphere"><a class="header" href="#suggested-mosfet-part-numbers-from-endless-sphere">Suggested MOSFET Part Numbers (from <a href="https://endless-sphere.com/forums/viewtopic.php?t=117045">Endless sphere</a>)</a></h2>
<p>100V</p>
<ul>
<li>CRST030N10N (Initial boards built with these)</li>
<li>MDP10N027 (another initial board built with these)</li>
<li>NCEP039N10</li>
<li>IPP026N10NF2S</li>
<li>DMTH10H005SCT</li>
</ul>
<p>150V</p>
<ul>
<li>CRST073N15N</li>
<li>NCEP15T14</li>
<li>NTP5D0N15MC</li>
<li>SUP70042E</li>
</ul>
<h2 id="issues-with-ncep039n10"><a class="header" href="#issues-with-ncep039n10">Issues With NCEP039N10</a></h2>
<p>These MOSFETs have about 2/3 the gate charge of ones previously tested. This may result in ringing problems, and they may have excess dead time that will reduce sensorless startup performance and waste a bit of power.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../hardware/ENCLOSURE_GALLERY.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../hardware/MOTOR_PARAM.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../hardware/ENCLOSURE_GALLERY.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../hardware/MOTOR_PARAM.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
