<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Measure motor resistance and inductance - Molonoy Electronic Speed Control (MESC) Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction/INTRODUCTION.html"><strong aria-hidden="true">1.</strong> Introduction to the MESC</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../introduction/FORWARD.html"><strong aria-hidden="true">1.1.</strong> Forward</a></li><li class="chapter-item expanded "><a href="../introduction/LICENSE.html"><strong aria-hidden="true">1.2.</strong> License</a></li><li class="chapter-item expanded "><a href="../introduction/FEATURES.html"><strong aria-hidden="true">1.3.</strong> Features</a></li></ol></li><li class="chapter-item expanded "><a href="../operation/INTRODUCTION.html"><strong aria-hidden="true">2.</strong> Theory and Operation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../operation/THEORY.html"><strong aria-hidden="true">2.1.</strong> Theory of operation</a></li><li class="chapter-item expanded "><a href="../operation/CONTROL.html"><strong aria-hidden="true">2.2.</strong> Control loops</a></li><li class="chapter-item expanded "><a href="../operation/PORTING.html"><strong aria-hidden="true">2.3.</strong> Porting to other microprocessors</a></li></ol></li><li class="chapter-item expanded "><a href="../debugging/DEBUGGING.html"><strong aria-hidden="true">3.</strong> Debugging STM32CubeIDE</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../debugging/FIRMWARE_INTRO.html"><strong aria-hidden="true">3.1.</strong> Getting started</a></li></ol></li><li class="chapter-item expanded "><a href="../MP2/INTRO.html"><strong aria-hidden="true">4.</strong> Reference ESC: the MP2</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../MP2/PCB_ASSEMBLY_TESTING.html"><strong aria-hidden="true">4.1.</strong> Assembly</a></li><li class="chapter-item expanded "><a href="../MP2/HIGHER_AMP_ASSEMBLY.html"><strong aria-hidden="true">4.2.</strong> Increasing amperage</a></li></ol></li><li class="chapter-item expanded "><a href="../hardware.html"><strong aria-hidden="true">5.</strong> Hardware</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../hardware/QS165_MP2_WIRING.html"><strong aria-hidden="true">5.1.</strong> Additional wiring for an QS165 motor</a></li><li class="chapter-item expanded "><a href="../hardware/ENCLOSURE_GALLERY.html"><strong aria-hidden="true">5.2.</strong> A gallery of enclosures</a></li><li class="chapter-item expanded "><a href="../hardware/MOSFET_PARAMETERS.html"><strong aria-hidden="true">5.3.</strong> An introduction to MOSFET parameters</a></li><li class="chapter-item expanded "><a href="../hardware/MOTOR_PARAM.html" class="active"><strong aria-hidden="true">5.4.</strong> Measure motor resistance and inductance</a></li><li class="chapter-item expanded "><a href="../hardware/MP2_F405PILL_PINOUTS.html"><strong aria-hidden="true">5.5.</strong> Information about the F405 pill</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Molonoy Electronic Speed Control (MESC) Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="calculation-of-bldc-motor-parameters"><a class="header" href="#calculation-of-bldc-motor-parameters">Calculation of BLDC Motor Parameters</a></h1>
<p>The MP2 as well as other VESC-based systems provide the capability to measure motor parameters using the controller. For example, <a href="https://vesc-project.com/vesc_tool">vesc-tool</a> collects several motor values from a connected motor and controller by selecting &quot;FOC&quot; on left panel, going to the &quot;General&quot; tab, and following the &quot;Detect and Calculate Parameters&quot; directions on that page. </p>
<p>So vesc-tool is great for retreiving parameters. However, in cases where you want to measure the parameters yourself or check if your VESC is gathering up the right numbers, this document is for you. </p>
<h2 id="preamble"><a class="header" href="#preamble">PREAMBLE</a></h2>
<p>Some notes before beginning.</p>
<p><strong>Expertise.</strong> This document assumes you have a reasonable understanding of concepts such as Ohm's law and inductance. It also assume that you're comfortable connecting up high amperage equipment which should be not any more complex than wiring your motor to a controller. You're also going to need to have a lot of familiarity with using VESC-based controllers. </p>
<p><strong>Equipment.</strong> In order to do what is described here you'll need the following: </p>
<ul>
<li>A multimeter</li>
<li>A current limiting power supply</li>
<li>A LCR meter</li>
<li>An oscilloscope</li>
</ul>
<p>You'll also need some way to turn your disconnected motor at a relatively precise rpm. More about that later. </p>
<p><strong>BLDC motor configuration.</strong> BLDC motors have two basic achitectures:</p>
<img src="pics/MOTOR_PARAM_wye_v_delta.png" title="Figure 1: motor configurations">
<p>If your BLDC has three big wires coming out of it, we are going to assume that motor is in Wye configuration for the sake of simplifying the math used here.</p>
<h2 id="resistance"><a class="header" href="#resistance">RESISTANCE</a></h2>
<p>The copper wires inside of a BLDC are long, and the resistance found in those windings is an important number. In some cases the resistance can be measure direcly with an ohmmeter, but cheap commerical ohmmeters often will not get down to the range needed to get a good value. Instead, perform the following:</p>
<ul>
<li>Find the rated amperage of your motor</li>
<li>Select a value around 10% of this rating</li>
<li>Set your current limited power supply to your selected amperage</li>
</ul>
<p>Your motor has three wires -- these are referred to as &quot;phase wires&quot; and are connected to the the termination points of the windings shown in <strong>Figure 2</strong>. Arbitrarily choose two wires, and connect them to your power supply. Note: the motor will <a href="https://www.youtube.com/watch?v=oRXPFaZ0nJI">jump</a> and then freeze to a holding position when you connect the power supply.</p>
<p>Now, at the same connection point of each phase wire, connect your multimeter to measure volts (you'll probably need something in the millivolt range). Get a number. Your results may look something like this:</p>
<img src="pics/MOTOR_PARAM_resistance.png" title="Figure 1. Capturing resistance based on Ohm's law">
<p>Notice that it would NOT work well to use the measurement that is coming from the power supply itself. Better to use what your multimeter is telling you. The connection used for this measurement is referred to as &quot;phase to phase&quot; because you're actually connecting between two phases of the motor to get your value. Grab your phase to phase voltage, and use Ohm's law to calculate the resistance. In our case:</p>
<ul>
<li>R = V / I</li>
<li>R = 129 mV / 10A</li>
<li>R = 12.9</li>
<li>Convert to single phase resistance: R = 12.9 / 2, or 6.45mOhms</li>
</ul>
<h2 id="inductance-values-lq-and-ld"><a class="header" href="#inductance-values-lq-and-ld">INDUCTANCE VALUES Lq AND Ld</a></h2>
<p>In our case we're going to measure inductance using an LCR meter. LCR meters measures inductance (L), capacitance (C), and resistance (R) and commercial meters are not particularly expensive.</p>
<p>Gathering inductance values requires that we find two important positions inside of your motor that have to do with the position of the stator coils and the rotor magnets. To find these positions you can use the power supply set at the values as before (or less). These positions are described below:</p>
<img src="pics/MOTOR_PARAM_Ld_Lq1.png" title="Figure 3. D-axis and Q-axis motor positions">
<p>Also see <a href="https://youtu.be/oRXPFaZ0nJI">this video</a> which shows a motor jumping around when the phase wires are connected to a power supply. The marked positions are referred to as d-axis and q-axis (note the above figure). Once you have these positions, do the following:</p>
<ul>
<li>Disconnect power supply</li>
<li>Turn the motor to d-axis position</li>
<li>Set your LCR to measure inductance</li>
<li>Using the same phase wires as when connected to the power supply, connect LCR</li>
<li>Get a reading for Ld</li>
<li>Turn motor to q-axis position</li>
<li>Get a reading for Lq</li>
</ul>
<p>Note, the motor may have residual inductance, or something, that means it takes a while for the L value to settle. In some cases metalic desk tops and placement of hands on the motor have influenced the L value. Take your time, and shorting the leads on the motor also helps to settle residual inductance.</p>
<p>Your measurements for Ld and Lq are phase to phase. Divide by 2 to get single phase Ld and Lq. To get total L for the motor calculate their average, or L = (Ld + Lq) / 2.</p>
<p>In our example here we get the following; (notice the position of the motor in each of the pics):
<img src="pics/MOTOR_PARAM_Ld_Lq2.png" title="Figure 4. Ld/Lq results"></p>
<ul>
<li>Phase to phase Ld measure = 174 uH</li>
<li>Phase to phase Lq measure = 199 uH</li>
<li>Thus, for single phase:  Ld = 87uH, Lq = 99.5uH, and L = 93uH</li>
</ul>
<h2 id="flux-linkage"><a class="header" href="#flux-linkage">FLUX LINKAGE</a></h2>
<p>You'll discover there is an abundance of ways to measure flux linkage out on the internet. In our case we're going to use an oscilloscope to emperically measure amplitude and period of the volts generated by your BLDC. From this we'll calculate lambda, which is the integral of volt x seconds. </p>
<p>To get this measurement you're going to need some way to turn your disconnected motor at a relatively precise rpm. You'll probably need to mount the motor, and then connect it to an electric drill or another motor. One method of turning a motor is <a href="https://youtube.com/shorts/YvglKtxUaCQ">shown here</a>. Turn the motor and collect the output of the motor on your scope.</p>
<p>Connect the ground end of your oscilloscope to one phase of the motor, and the probe to another phase. Be sure to note the scope settings for volts / div for the amplitude and ms / div for period. Once you have all this extract values for Vpeak and period of your sine wave. Here's an example:</p>
<img src="pics/MOTOR_PARAM_scope.png" title="Figure 5. Oscilloscope measurements of BLDC motor output">
<p>The scope is set to 2V / div for voltage and and 5ms / div for period. In our pic, Vpeak = 5V, and period, or T = 28ms. The formula to calculate lambda is:</p>
<img src="pics/MOTOR_PARAM_lambda.png" title="equation for flux linkage">
<p>Note: your measurement for the scope is collected from phase to phase; however, this formula does not require that you convert to single phase lambda, the formula handles it for you. </p>
<h2 id="comparison-to-vesc-values"><a class="header" href="#comparison-to-vesc-values">COMPARISON TO VESC VALUES</a></h2>
<p>Let's compare these values to what was collected using a 75V 100A single ESC single ubox from Spintend. For the motor used here, this is what you get in vesc-tool by selecting &quot;FOC&quot; on left panel, going to the &quot;General&quot; tab, and following the &quot;Detect and Calculate Parameters&quot; directions on that page:</p>
<img src="pics/MOTOR_PARAM_vesc-tool.png" title="Figure 6. vesc-tool detection results">
<p>Comparing to our emperical values, we get:</p>
<img src="pics/MOTOR_PARAM_table.png" title="comparing results">
<p>These are values are very close. Note that your results are always going to vary based on your controller, wiring, and motor parameters. </p>
<p>(*) One exception is the resistance. In this example the resistance of the motor is relatively low and the discrepancy here is probably due to added resistance of the MOSFETs in the ubox. The MOSFET resistance would not be as significant for motors with a higher resistance. </p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../hardware/MOSFET_PARAMETERS.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../hardware/MP2_F405PILL_PINOUTS.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../hardware/MOSFET_PARAMETERS.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../hardware/MP2_F405PILL_PINOUTS.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
