<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Getting started - Molonoy Electronic Speed Control (MESC) Documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction/INTRODUCTION.html"><strong aria-hidden="true">1.</strong> Introduction to the MESC</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../introduction/FORWARD.html"><strong aria-hidden="true">1.1.</strong> Forward</a></li><li class="chapter-item expanded "><a href="../introduction/LICENSE.html"><strong aria-hidden="true">1.2.</strong> License</a></li><li class="chapter-item expanded "><a href="../introduction/FEATURES.html"><strong aria-hidden="true">1.3.</strong> Features</a></li></ol></li><li class="chapter-item expanded "><a href="../operation/INTRODUCTION.html"><strong aria-hidden="true">2.</strong> Theory and Operation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../operation/THEORY.html"><strong aria-hidden="true">2.1.</strong> Theory of operation</a></li><li class="chapter-item expanded "><a href="../operation/CONTROL.html"><strong aria-hidden="true">2.2.</strong> Control loops</a></li><li class="chapter-item expanded "><a href="../operation/PORTING.html"><strong aria-hidden="true">2.3.</strong> Porting to other microprocessors</a></li></ol></li><li class="chapter-item expanded "><a href="../debugging/DEBUGGING.html"><strong aria-hidden="true">3.</strong> Debugging STM32CubeIDE</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../debugging/FIRMWARE_INTRO.html" class="active"><strong aria-hidden="true">3.1.</strong> Getting started</a></li></ol></li><li class="chapter-item expanded "><a href="../MP2/INTRO.html"><strong aria-hidden="true">4.</strong> Reference ESC: the MP2</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../MP2/PCB_ASSEMBLY_TESTING.html"><strong aria-hidden="true">4.1.</strong> Assembly</a></li><li class="chapter-item expanded "><a href="../MP2/HIGHER_AMP_ASSEMBLY.html"><strong aria-hidden="true">4.2.</strong> Increasing amperage</a></li></ol></li><li class="chapter-item expanded "><a href="../hardware.html"><strong aria-hidden="true">5.</strong> Hardware</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../hardware/QS165_MP2_WIRING.html"><strong aria-hidden="true">5.1.</strong> Additional wiring for an QS165 motor</a></li><li class="chapter-item expanded "><a href="../hardware/ENCLOSURE_GALLERY.html"><strong aria-hidden="true">5.2.</strong> A gallery of enclosures</a></li><li class="chapter-item expanded "><a href="../hardware/MOSFET_PARAMETERS.html"><strong aria-hidden="true">5.3.</strong> An introduction to MOSFET parameters</a></li><li class="chapter-item expanded "><a href="../hardware/MOTOR_PARAM.html"><strong aria-hidden="true">5.4.</strong> Measure motor resistance and inductance</a></li><li class="chapter-item expanded "><a href="../hardware/MP2_F405PILL_PINOUTS.html"><strong aria-hidden="true">5.5.</strong> Information about the F405 pill</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Molonoy Electronic Speed Control (MESC) Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="getting-started-install-and-debug-mesc-firmware"><a class="header" href="#getting-started-install-and-debug-mesc-firmware">GETTING STARTED: Install and Debug MESC Firmware</a></h1>
<h2 id="debugging-in-cubeide"><a class="header" href="#debugging-in-cubeide">Debugging in CubeIDE</a></h2>
<p>Almost all variables of interest can be found in the struct mtr[]
mtr[] is an array of structs containing the FOC, the raw and converted ADC values, the states, the motor parameter...
mtr[] can contain n motors. Adding this to the live expressions allows you to view everything about the setup.
mtr[n]-&gt;mtimer points to the instance of the ST timer.
mtr[n]-&gt;stimer points to the timer used for the slow loop.
Mutliple motors can be accomodated, but need patching to the correct ADC readings, which need triggering byt the associated timer.
Some variables are assumed to be the same for multiple motors e.g. current limits, voltage limits... 
These can be found in struct g_hw_setup</p>
<h2 id="getting-started"><a class="header" href="#getting-started">Getting started</a></h2>
<p>Install STM32CubeIDE from https://www.st.com/en/development-tools/stm32cubeide.html</p>
<p>On the command line clone the github repository using:</p>
<pre><code>% git clone https://github.com/davidmolony/MESC_Firmware.git
</code></pre>
<p>Start up the STM32CubeIDE. A workspace area is used by STM32CubeIDE to store all of your projects. The first time you start STM32CubeIDE it will want to create a workspace, if you dont have one. </p>
<img src="pics/IDE_1_create_workspace.png" title="Creating a workspace">
<p>Create a name if needed, select &quot;Launch&quot; </p>
<p>When the IDE comes up for the first time, it may show an information center.</p>
<img src="pics/IDE_2_splashscreen.png" title="The IDE splash screen">
<p>Close on this feature.</p>
<p>The IDE may show a project explorer tab on the left, if you do not see the project explorer:</p>
<p>Window--&gt;Show View--&gt;Project explorer</p>
<p>The project explorer may show &quot;Import projects...&quot; select that, or if you do not see that function, try:</p>
<p>File--&gt;Import...</p>
<p>An import selector should come up:</p>
<img src="pics/IDE_3_import_selector.png" title="Import selection tool">
<p>Set up General--&gt;Existing Projects into Workspace, select Next</p>
<p>Browse for the top-level github folder you created, hit open the import function will show this:</p>
<img src="pics/IDE_4_import_projects.png" title="Importing projects">
<p>Select finish. This should load a set of MESC projects into the Project Explorer, expand the top-level folder and you should see:</p>
<p>At this point if you select</p>
<p>Project--&gt;Build All (or the icons on top of the IDE also help with builds)</p>
<p>you should see the IDE compile the MESC_firmware in all the sub directories. </p>
<img src="pics/IDE_5_firmware_build.png" title="Compiling firmware">
<p>When you select the .ioc file in the file browser this tool pops up. By working with the pull down menus on each pin, you can view or set the functions on that pin. This tool also allows you to change many other functions like the timers, UARTS, and ADCs. </p>
<img src="pics/IDE_6_IOC_review1.png" title="View pin functions">
<h2 id="debugging----getting-started"><a class="header" href="#debugging----getting-started">Debugging -- getting started</a></h2>
<p>To connect up your pill, you will use the abundantly available ST-LINK V2 debugger, and get connected like this:</p>
<img src="pics/IDE_7_stlink.png" title="ST-LINK pin connections">
<p>There are a couple of settings to watch out for in the configuration of the debugger. Make sure these parameters are set up:
<img src="pics/IDE_8_settings1.png" title="Configure the debugger"></p>
<p>There are a couple of settings to watch out for in the configuration of the debugger. Make sure these parameters are set up:
<img src="pics/IDE_9_settings2.png" title="Configure the debugger"></p>
<p>Once your st-link is connected and the debugger is configured you can get started by hitting this button. Sometimes you have to use that button's pulldown menu to select the debugging style that you want: 
<img src="pics/IDE_10_debug.png" title="ST-LINK pin connections"></p>
<h2 id="debugging----what-to-do-next"><a class="header" href="#debugging----what-to-do-next">Debugging -- what to do next</a></h2>
<p>There are approximately 10<sup>5</sup> google results for <a href="https://www.google.com/search?q=stm32cubeide+debugging">STM32cubeIDE debugging</a>. Do your best. </p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../debugging/DEBUGGING.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../MP2/INTRO.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../debugging/DEBUGGING.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../MP2/INTRO.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
